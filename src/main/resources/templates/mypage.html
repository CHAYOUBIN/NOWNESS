<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:lang="ko">
<head>
    <meta charset="UTF-8">
    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">
    <script th:src="@{/js/jquery-3.7.0.min.js}"></script>
    <title>NOWNESS</title>
</head>
<body>
<h1>MYPAGE</h1>
<ul>
    <li th:text="${id}">id</li>
    <li th:text="${email}">email</li>
    <li th:text="${nickname}">nickname</li>
</ul>

<!-- thymeleaf prefix 를 사용한 form 이므로 자동으로 hidden type 의 input 태그에 csrf 토큰 값이 자동으로 생성됨-->
<form method="POST" th:action="@{/user/logout}">
    <input type="submit" class="btn-primary" value="로그아웃"/>
</form>

<!-- thymeleaf prefix 를 사용한 form 을 만들지 않으면 hidden type 의 csrf 토큰 값이 자동으로 생성되지 않음
그래서 script 로 post 요청 만들어서 보내려면 csrf 추가해서 보내야함-->
<input id="csrf" type="hidden" name="_csrf" th:value="${_csrf.token}"/>
<button type="button" class="btn-primary">로그아웃 by button</button>
<script>
    $(document).ready(() => {
        // post request
        $("button").click(() => {
            $.post("/user/logout", { "_csrf": $("#csrf").val()}, function(data, status){
                // 성공적으로 요청을 보냈을 때 실행되는 콜백 함수
                // 현재 html 을 반환하는 경로로 지정해서 html 이 응답으로 옴
                // 추후에 경로를 api 로 변경해서 DOM 전체를 업데이트 하지 않고 로그아웃
                console.log("응답 데이터: " + data);
                console.log("응답 상태: " + status);
            }).fail(function(xhr, status, error) {
                // 요청이 실패했을 때 실행되는 콜백 함수
                console.log("오류: " + error);
            });
        })
    })
</script>
</body>
</html>
