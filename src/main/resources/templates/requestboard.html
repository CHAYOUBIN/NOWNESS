<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:lang="ko">
<head>
    <meta charset="UTF-8">
    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">
    <script th:src="@{/js/jquery-3.7.0.min.js}"></script>
<!--    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>-->
    <title>NOWNESS</title>
    <meta name="_csrf_header" th:content="${_csrf.headerName}">
    <meta name="_csrf" th:content="${_csrf.token}">
    <style>
        body{
            font-size: 16px;
        }

        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }


        .request_list{
            margin: 0 auto;
            width: 70%;
            height: 80%;

        }

        @font-face {
            font-family: 'NeoDunggeunmoPro-Regular';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2302@1.0/NeoDunggeunmoPro-Regular.woff2') format('woff2');
            font-weight: normal;
            font-style: normal;
        }
        body {
            font-family: 'NeoDunggeunmoPro-Regular', sans-serif;
        }


    </style>




 <script th:inline="javascript">











     //테스트용
        //ajax 이용 , 카테고리별 나누려는 테스트중. -작동안하는거같음.
        function updateRequestList(boardType, page) {
            var url = "/list/request?boardType=" + boardType + "&page=" + page;
            $.ajax({
                type: "GET",
                url: url,
                success: function(response) {
                    var requestList = response;
                    var tableBody = $('#requestListTableBody');
                    tableBody.empty();

                    var totalCount = response.totalCount; // Total count of requests
                    var pageSize = response.pageSize; // Number of requests per page
                    var currentPage = response.currentPage; // Current page

                    var startIndex = (currentPage - 1) * pageSize + 1; // Calculate the starting post number for the current page

                    $.each(requestList, function(index, request) {
                        var postNumber = startIndex + index;
                        var row = $('<tr>').addClass('text-center');
                        $('<th>').attr('scope', 'row').text(postNumber).appendTo(row);
                        $('<th>').attr('scope', 'row').text(request.id).appendTo(row);
                        $('<td>').append(
                            $('<a>').attr('href', '/request/post/' + request.id).text(request.title)
                        ).appendTo(row);
                        $('<td>').text(request.userId).appendTo(row);
                        $('<td>').text(request.createdDatetime).appendTo(row);
                        row.appendTo(tableBody);
                    });

                    updatePagination(page, response.totalPages, boardType);
                },
                error: function(e) {
                    alert('Error occurred while retrieving request list.' + JSON.stringify(e));
                    console.log(JSON.stringify(e));
                }
            });
        }


        <!--페이지네이션 바뀌는 부분. -->
        function updatePagination(currentPage, totalPages, boardType) {
            var paginationDiv = $('.pagination');
            paginationDiv.empty();

            paginationDiv.append(
                $('<a>').addClass('btn btn-primary').attr('href', '/request/list?boardType=' + boardType + '&page=1').text('First')
            );

            if (currentPage > 1) {
                paginationDiv.append(
                    $('<a>').addClass('btn btn-primary').attr('href', '/request/list?boardType=' + boardType + '&page=' + (currentPage - 1)).text('Previous')
                );
            }

            for (var i = 1; i <= totalPages; i++) {
                paginationDiv.append(
                    $('<a>').addClass('btn btn-primary').attr('href', '/request/list?boardType=' + boardType + '&page=' + i).text(i)
                );
            }

            if (currentPage < totalPages) {
                paginationDiv.append(
                    $('<a>').addClass('btn btn-primary').attr('href', '/request/list?boardType=' + boardType + '&page=' + (currentPage + 1)).text('Next')
                );
            }


            paginationDiv.append(
                $('<a>').addClass('btn btn-primary').attr('href', '/request/list?boardType=' + boardType + '&page=' + totalPages).text('Last')
            );
        }

        // $('.boardTypeBtn').click(function() {
        //     $('.boardTypeBtn').removeClass('active');
        //     $(this).addClass('active');
        //     var boardType = $(this).data('board-type');
        //     updateRequestList(boardType, ${boardType});
        // });
        //
        // $(document).on('click', '.pagination a', function(e) {
        //     e.preventDefault();
        //     var page = $(this).attr('href').split('page=')[1];
        //     var boardType = $('.boardTypeBtn.active').data('board-type');
        //     updateRequestList(boardType, page);
        // });




 </script>

</head>


<body>
<div th:insert="~{header :: header}"></div>


<!--&lt;!&ndash;게시판보드 이름 누르면 게시판리스트 링크&ndash;&gt;-->
<!--<a href="/request/list">-->
<!--    <h1>REQUESTBOARD</h1>-->
<!--</a>-->


<!--카테고리별 분류 테스트버튼 *현재작동XX*-->
<!--<button class="btn btn-primary boardTypeBtn active" data-board-type="1">Board Type 1</button>-->
<!--<button class="btn btn-primary boardTypeBtn" data-board-type="2">Board Type 2</button>-->

<br>
<div class="container text-center">
    <div class="row">
        <div class="col">
            중분류1
        </div>
        <div class="col">
            중분류2
        </div>
    </div>
    <div class="row">
        <div class="col">
            하위카테고리1
        </div>
        <div class="col">
            하위카테고리2
        </div>
        <div class="col">
            하위카테고리3
        </div>
    </div>
</div>




<hr>


<!--게시판 리스트 목차, 기본 구성-->
<div class="request_list">
    <table class="table">
        <thead class="thead-light">
        <tr class="text-center">
            <th scope="col">게시글순서</th>
            <th scope="col">게시글원래번호(id)</th>
            <th scope="col">제목</th>
            <th scope="col">작성자</th>
            <th scope="col">조회수</th>
            <th scope="col">작성일</th>
        </tr>
        </thead>
        <tbody id="requestListTableBody">
        <tr class="text-center" th:each="request, index : ${lists}">
            <th scope="row">
                <span th:text="${(20 * (totalPages - currentPage +1)) - index.index }"></span>
            </th>
            <th scope="row">
                <span th:text="${request.id}"></span>
            </th>
            <td>
                <a th:href="@{'/request/post/' + ${request.id}}">
                    <span th:text="${request.title}"></span>
                </a>
            </td>
            <td>
                <span th:text="${request.userId}"></span>
            </td>
            <td>
                <span th:text="${request.views}"></span>
            </td>
            <td>
                <span th:text="${request.createdDatetime}"></span>
            </td>
        </tr>
        </tbody>
    </table>
</div>




<!--맨처음 게시판 페이지네이션 나타나는곳-->
<div class="pagination">
    <a class="btn btn-primary" th:href="@{/request/list(page=1, boardType=${boardType})}" role="button">First</a>
    <a class="btn btn-primary" th:if="${currentPage > 1}" th:href="@{/request/list(page=${currentPage - 1}, boardType=${boardType})}" role="button">Previous</a>
    <div th:each="pageNumber : ${#numbers.sequence(1, totalPages)}">
        <a class="btn btn-primary" th:href="@{/request/list(page=${pageNumber}, boardType=${boardType})}" th:text="${pageNumber}" role="button"></a>
    </div>
    <a class="btn btn-primary" th:if="${currentPage < totalPages}" th:href="@{/request/list(page=${currentPage + 1}, boardType=${boardType})}" role="button">Next</a>
    <a class="btn btn-primary" th:href="@{/request/list(page=${totalPages}, boardType=${boardType})}" role="button">Last</a>
</div>

<!--글쓰기버튼-->
<!--<a th:href="@{'/request/writer'}" id="writebtn">글쓰기</a>-->
<button type="button" id="writebtn">글쓰기</button>




<div th:insert="~{footer :: footer}"></div>
<script th:src="@{/static/js/bootstrap.min.js}"></script>


<script th:inline="javascript">
    $(document).ready(function() {
        var token = $("meta[name='_csrf']").attr("content");
        var header = $("meta[name='_csrf_header']").attr("content");

        var loginuser = [[${userId}]];
        var verifiedUser = [[${verifiedUser}]];

        alert(loginuser);

        // 글쓰기 버튼 클릭 이벤트
        $("#writebtn").click(function(event) {
            event.preventDefault();

            alert(verifiedUser);

            if (loginuser !== null) {
                if(verifiedUser == true){
                    //로그인O, 이메일인증O
                    window.location.href = "/request/writer";
                }else{
                    //로그인은했고, 이메일인증X인경우
                    alert("이메일 인증을 완료해주시기 바랍니다.")
                }
            } else {
                //로그인아이디가없는경우
                alert("로그인을 해주세요");
            }//로그인유무end
        });
    });



</script>


</body>
</html>

